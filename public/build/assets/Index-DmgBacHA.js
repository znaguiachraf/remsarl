import{b as ue,a as o,j as e,H as xe,L as he,r as L}from"./app-nMU3D5F2.js";import{P as pe}from"./ProjectLayout-CiXiOud_.js";import{I as M}from"./InputError-BCWVG35a.js";import{I as C}from"./InputLabel-BKlmGBMn.js";import{T as k}from"./TextInput-fsUOQVXO.js";import{M as Y}from"./SecondaryButton-D88lzX2s.js";import"./AuthErrorHandler-0iv1Y0bc.js";import"./Dropdown-3VR5xFcl.js";import"./transition-B1micqJt.js";function Fe({project:d,session:l,products:$,categories:G=[],can:g}){const{currentProject:q,flash:E}=ue().props,r=q?.primary_color||"#3B82F6",A=q?.secondary_color||"#10B981",[i,x]=o.useState([]),[w,J]=o.useState(""),[I,B]=o.useState("0"),[K,y]=o.useState(!1),[D,O]=o.useState(""),[Q,h]=o.useState(!1),[T,U]=o.useState("cash"),[R,F]=o.useState(""),[f,S]=o.useState([]),[j,m]=o.useState(!1),[b,c]=o.useState({}),[v,X]=o.useState(""),[Z,_]=o.useState(!1),V=o.useRef(null),ee=o.useMemo(()=>{let s=$||[];const t=(w||"").toLowerCase().trim();if(t&&(s=s.filter(a=>a.name.toLowerCase().includes(t)||a.id.toString().includes(t))),v){const a=parseInt(v,10);s=s.filter(n=>n.category_id===a)}return s},[$,w,v]),se=o.useCallback(()=>{V.current?.requestFullscreen?.().then(()=>{_(!0)}).catch(()=>{})},[]),te=o.useCallback(()=>{document.exitFullscreen?.().then(()=>{_(!1)}).catch(()=>{})},[]);o.useEffect(()=>{const s=()=>{_(!!document.fullscreenElement)};return document.addEventListener("fullscreenchange",s),()=>document.removeEventListener("fullscreenchange",s)},[]);const re=o.useCallback(s=>{const t=i.find(a=>a.product_id===s.id);x(t?i.map(a=>a.product_id===s.id?{...a,quantity:a.quantity+1}:a):[...i,{product_id:s.id,name:s.name,quantity:1,unit_price:s.price}])},[i]),ae=o.useCallback((s,t,a)=>{x(n=>{const p=[...n];return p[s]={...p[s],[t]:a},t==="quantity"&&parseInt(a,10)<=0?n.filter((ge,me)=>me!==s):p})},[]),ne=o.useCallback(s=>{x(t=>t.filter((a,n)=>n!==s))},[]),oe=o.useCallback(()=>{x([]),S([]),h(!1),F("")},[]),W=i.reduce((s,t)=>s+t.quantity*(t.unit_price||0),0),H=parseFloat(I)||0,N=Math.max(0,W-H),P=f.reduce((s,t)=>s+(parseFloat(t.amount)||0),0),u=N-P,le=()=>{const s=parseFloat(R)||0;if(!(s<=0)){if(s>u){c({payment:"Amount exceeds remaining due."});return}S(t=>[...t,{payment_method:T,amount:s.toString()}]),F(""),h(!1),c({})}},ie=s=>{S(t=>t.filter((a,n)=>n!==s))},ce=s=>{s.preventDefault(),c({});const t=i.filter(n=>n.quantity>0).map(n=>({product_id:n.product_id,quantity:parseInt(n.quantity,10),unit_price:parseFloat(n.unit_price)||0}));if(t.length===0){c({items:"Add at least one product to the cart."});return}const a=f.filter(n=>parseFloat(n.amount)>0).map(n=>({payment_method:n.payment_method,amount:parseFloat(n.amount),reference:null}));if(a.reduce((n,p)=>n+p.amount,0)<N){c({payments:`Total payments (${P.toFixed(2)}) must cover the total (${N.toFixed(2)}).`});return}m(!0),L.post(route("projects.modules.pos.orders.store",d.id),{items:t,discount:H,payments:a},{preserveScroll:!0,onFinish:()=>m(!1),onSuccess:()=>{oe(),B("0")},onError:n=>c(n)})},z=s=>{s.preventDefault(),m(!0),L.post(route("projects.modules.pos.session.open",d.id),{},{preserveScroll:!0,onFinish:()=>m(!1),onError:t=>c(t)})},de=s=>{s.preventDefault();const t=parseFloat(D);if(isNaN(t)||t<0){c({closing_cash:"Enter a valid closing cash amount."});return}m(!0),L.post(route("projects.modules.pos.session.close",[d.id,l.id]),{closing_cash:t},{preserveScroll:!0,onFinish:()=>m(!1),onSuccess:()=>{y(!1),O("")},onError:a=>c(a)})};return e.jsxs(pe,{header:e.jsxs("div",{className:"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(he,{href:route("projects.show",d.id),className:"rounded-lg p-2 text-gray-500 hover:bg-gray-100 hover:text-gray-700",children:e.jsx("svg",{className:"h-5 w-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 19l-7-7m0 0l7-7m-7 7h18"})})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-800",children:"Point of Sale"}),e.jsx("p",{className:"text-sm text-gray-500",children:d.name})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[l&&e.jsx(e.Fragment,{children:e.jsx("button",{type:"button",onClick:se,title:"Fullscreen",className:"rounded-lg border p-2 transition hover:opacity-90",style:{borderColor:`${r}40`,backgroundColor:`${r}10`,color:r},children:e.jsx("svg",{className:"h-5 w-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4"})})})}),l?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-2 rounded-lg border px-4 py-2",style:{borderColor:l.status==="open"?r:"#9CA3AF",backgroundColor:l.status==="open"?`${r}15`:"#F3F4F6"},children:[e.jsx("span",{className:"h-2.5 w-2.5 rounded-full",style:{backgroundColor:l.status==="open"?r:"#9CA3AF"}}),e.jsxs("span",{className:"text-sm font-medium text-gray-700",children:["Session ",l.session_number," • ",l.status==="open"?"Open":"Closed"]})]}),g.close_session&&l.status==="open"&&e.jsx("button",{type:"button",onClick:()=>y(!0),className:"rounded-lg border border-red-200 bg-white px-4 py-2 text-sm font-medium text-red-700 hover:bg-red-50",children:"Close Session"})]}):g.open_session&&e.jsx("button",{type:"button",onClick:z,disabled:j,className:"rounded-lg px-4 py-2 text-sm font-medium text-white",style:{backgroundColor:r},children:"Open Session"})]})]}),children:[e.jsx(xe,{title:`POS - ${d.name}`}),E?.success&&e.jsx("div",{className:"mb-4 rounded-lg p-4 text-sm font-medium",style:{backgroundColor:`${r}15`,color:r},children:E.success}),l?e.jsxs("div",{ref:V,className:"flex min-h-0 flex-col rounded-xl bg-white p-4 md:min-h-[calc(100vh-12rem)] md:p-6 lg:min-h-[calc(100vh-10rem)] [&:fullscreen]:p-6",style:{"--project-primary":r,"--project-secondary":A},children:[Z&&e.jsx("div",{className:"mb-4 flex justify-end",children:e.jsxs("button",{type:"button",onClick:te,title:"Exit fullscreen",className:"flex items-center gap-2 rounded-lg px-4 py-2 text-sm font-medium text-white transition hover:opacity-90",style:{backgroundColor:A},children:[e.jsx("svg",{className:"h-5 w-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})}),"Exit fullscreen"]})}),e.jsxs("div",{className:"grid flex-1 gap-4 md:grid-cols-3 md:gap-6 lg:gap-8",children:[e.jsxs("div",{className:"flex min-h-0 flex-col md:col-span-2",children:[e.jsxs("div",{className:"mb-3 flex flex-col gap-3 sm:flex-row sm:items-center",children:[e.jsx(k,{type:"search",placeholder:"Search products by name or ID...",value:w,onChange:s=>J(s.target.value),className:"w-full sm:flex-1",autoFocus:!0}),e.jsxs("select",{value:v,onChange:s=>X(s.target.value),className:"rounded-md border-gray-300 text-sm focus:border-[var(--project-primary)] focus:ring-[var(--project-primary)] sm:w-40",children:[e.jsx("option",{value:"",children:"All categories"}),G.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]})]}),e.jsx("div",{className:"grid min-h-0 flex-1 grid-cols-2 gap-2 overflow-y-auto sm:grid-cols-3 md:grid-cols-3 md:gap-3 lg:grid-cols-4 lg:gap-4",children:ee.map(s=>e.jsxs("button",{type:"button",onClick:()=>re(s),className:"flex flex-col rounded-lg border border-gray-200 bg-white p-3 text-left shadow-sm transition hover:border-[var(--project-primary)] hover:shadow md:p-4",children:[e.jsx("span",{className:"truncate text-sm font-medium text-gray-900 md:text-base",children:s.name}),e.jsx("span",{className:"mt-1 text-sm font-semibold",style:{color:r},children:(s.price||0).toFixed(2)}),s.stock!==void 0&&e.jsxs("span",{className:"mt-0.5 text-xs text-gray-500",children:["Stock: ",s.stock]})]},s.id))})]}),e.jsxs("div",{className:"flex min-h-0 flex-col rounded-xl border bg-white shadow-sm md:min-h-[400px]",style:{borderColor:`${r}30`},children:[e.jsx("div",{className:"shrink-0 border-b px-4 py-3",style:{borderColor:`${r}20`},children:e.jsx("h3",{className:"font-semibold",style:{color:r},children:"Cart"})}),e.jsx("div",{className:"min-h-0 flex-1 overflow-y-auto p-4 md:max-h-72",children:i.length===0?e.jsx("p",{className:"text-center text-sm text-gray-500",children:"Cart is empty"}):e.jsx("ul",{className:"space-y-2",children:i.map((s,t)=>e.jsxs("li",{className:"flex items-center justify-between gap-2 rounded-lg bg-gray-50 p-2",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("span",{className:"block truncate text-sm font-medium",children:s.name}),e.jsxs("div",{className:"mt-1 flex items-center gap-2",children:[e.jsx("input",{type:"number",min:"1",value:s.quantity,onChange:a=>ae(t,"quantity",a.target.value),className:"w-16 rounded border border-gray-300 px-2 py-1 text-sm"}),e.jsxs("span",{className:"text-xs text-gray-500",children:["× ",(s.unit_price||0).toFixed(2)]})]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"text-sm font-semibold",children:(s.quantity*(s.unit_price||0)).toFixed(2)}),e.jsx("button",{type:"button",onClick:()=>ne(t),className:"rounded p-1 text-red-600 hover:bg-red-50",children:e.jsx("svg",{className:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})]},`${s.product_id}-${t}`))})}),e.jsxs("div",{className:"border-t border-gray-200 p-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Subtotal"}),e.jsx("span",{children:W.toFixed(2)})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(C,{className:"text-xs",children:"Discount"}),e.jsx(k,{type:"number",min:"0",step:"0.01",value:I,onChange:s=>B(s.target.value),className:"w-24"})]}),e.jsxs("div",{className:"flex justify-between border-t pt-2 font-semibold",style:{borderColor:`${r}30`},children:[e.jsx("span",{style:{color:r},children:"Total"}),e.jsx("span",{style:{color:r},children:N.toFixed(2)})]})]}),f.length>0&&e.jsxs("div",{className:"mt-3 space-y-1",children:[e.jsx("p",{className:"text-xs font-medium text-gray-600",children:"Payments"}),f.map((s,t)=>e.jsxs("div",{className:"flex items-center justify-between rounded bg-gray-50 px-2 py-1 text-sm",children:[e.jsx("span",{className:"capitalize",children:s.payment_method}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:(parseFloat(s.amount)||0).toFixed(2)}),e.jsx("button",{type:"button",onClick:()=>ie(t),className:"text-red-600 hover:underline",children:"Remove"})]})]},t)),e.jsxs("div",{className:"flex justify-between text-sm font-medium",children:[e.jsx("span",{children:"Paid"}),e.jsx("span",{children:P.toFixed(2)})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Remaining"}),e.jsx("span",{children:u.toFixed(2)})]})]}),u>0&&i.length>0&&e.jsx("button",{type:"button",onClick:()=>h(!0),className:"mt-3 w-full rounded-lg border py-2 text-sm font-medium transition hover:opacity-90",style:{borderColor:r,color:r,backgroundColor:`${r}10`},children:"Add Payment"}),e.jsx(M,{message:b.items||b.payments,className:"mt-2"}),e.jsx("button",{type:"button",onClick:ce,disabled:j||i.length===0||u>0||!g.create_order,className:"mt-4 w-full rounded-lg py-3 text-lg font-semibold text-white disabled:opacity-50",style:{backgroundColor:r},children:"Complete Sale"})]})]})]})]}):e.jsxs("div",{className:"flex flex-col items-center justify-center rounded-xl border-2 border-dashed p-12 text-center",style:{borderColor:`${r}40`,backgroundColor:`${r}08`},children:[e.jsx("svg",{className:"mx-auto h-16 w-16",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",style:{color:`${r}60`},children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"})}),e.jsx("h3",{className:"mt-4 text-lg font-medium text-gray-900",children:"No open session"}),e.jsx("p",{className:"mt-2 max-w-sm text-gray-600",children:"Open a session to start making sales. You can only have one open session at a time."}),g.open_session&&e.jsx("button",{type:"button",onClick:z,disabled:j,className:"mt-6 rounded-lg px-6 py-3 text-white",style:{backgroundColor:r},children:"Open Session"})]}),e.jsx(Y,{show:K,onClose:()=>y(!1),children:e.jsxs("form",{onSubmit:de,className:"p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Close Session"}),e.jsxs("p",{className:"mt-1 text-sm text-gray-600",children:["Enter the closing cash count for session ",l?.session_number,"."]}),e.jsxs("div",{className:"mt-4",children:[e.jsx(C,{htmlFor:"closing_cash",children:"Closing Cash"}),e.jsx(k,{id:"closing_cash",type:"number",min:"0",step:"0.01",value:D,onChange:s=>O(s.target.value),className:"mt-1 w-full",required:!0}),e.jsx(M,{message:b.closing_cash,className:"mt-1"})]}),e.jsxs("div",{className:"mt-6 flex justify-end gap-3",children:[e.jsx("button",{type:"button",onClick:()=>y(!1),className:"rounded-lg border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:j,className:"rounded-lg bg-red-600 px-4 py-2 text-sm font-medium text-white hover:bg-red-700 disabled:opacity-50",children:"Close Session"})]})]})}),e.jsx(Y,{show:Q,onClose:()=>h(!1),children:e.jsxs("form",{onSubmit:s=>{s.preventDefault(),le()},className:"p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Add Payment"}),e.jsxs("p",{className:"mt-1 text-sm text-gray-600",children:["Remaining due: ",u.toFixed(2)]}),e.jsxs("div",{className:"mt-4 space-y-4",children:[e.jsxs("div",{children:[e.jsx(C,{htmlFor:"payment_method",children:"Method"}),e.jsxs("select",{id:"payment_method",value:T,onChange:s=>U(s.target.value),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-[var(--project-primary)] focus:ring-[var(--project-primary)]",children:[e.jsx("option",{value:"cash",children:"Cash"}),e.jsx("option",{value:"card",children:"Card"}),e.jsx("option",{value:"transfer",children:"Transfer"}),e.jsx("option",{value:"check",children:"Check"}),e.jsx("option",{value:"other",children:"Other"})]})]}),e.jsxs("div",{children:[e.jsx(C,{htmlFor:"payment_amount",children:"Amount"}),e.jsx(k,{id:"payment_amount",type:"number",min:"0.01",step:"0.01",value:R,onChange:s=>F(s.target.value),placeholder:u.toFixed(2),className:"mt-1 w-full",required:!0}),e.jsx(M,{message:b.payment,className:"mt-1"})]})]}),e.jsxs("div",{className:"mt-6 flex justify-end gap-3",children:[e.jsx("button",{type:"button",onClick:()=>h(!1),className:"rounded-lg border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50",children:"Cancel"}),e.jsx("button",{type:"submit",className:"rounded-lg px-4 py-2 text-sm font-medium text-white",style:{backgroundColor:r},children:"Add Payment"})]})]})})]})}export{Fe as default};
