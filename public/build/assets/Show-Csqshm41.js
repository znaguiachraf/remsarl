import{b as P,a as b,u as N,j as e,H as D,L as u,r as v}from"./app-CV_ed7_i.js";import{P as M}from"./ProjectLayout-CCBX1sk_.js";import{M as _,S as m}from"./SecondaryButton-PnKEJt8F.js";import{P as x}from"./PrimaryButton-fG5qMxE-.js";import{I as h}from"./InputLabel-Covi2RWO.js";import{T as g}from"./TextInput-BQNjFm02.js";import{I as E}from"./InputError-chaytR5f.js";import{e as w,b as S,a as F,g as $,o as T}from"./Icons-CUEBKkf-.js";import"./AuthErrorHandler-CZjHl6Ix.js";import"./Dropdown-BLtL5ZC7.js";import"./transition-wRWBGdP0.js";const O={draft:"bg-gray-100 text-gray-800",sent:"bg-blue-100 text-blue-800",partial:"bg-amber-100 text-amber-800",received:"bg-emerald-100 text-emerald-800",cancelled:"bg-red-100 text-red-800"};function Y({project:l,order:s,locations:j}){const k=P().props.currentProject?.primary_color||"#3B82F6",y="focus:border-[var(--project-primary)] focus:ring-[var(--project-primary)]",[C,c]=b.useState(!1),[q,d]=b.useState(!1),a=N({location_id:"",receipts:s?.items?.filter(t=>t.quantity_remaining>0).map(t=>({item_id:t.id,quantity:t.quantity_remaining}))??[]}),r=N({bill_reference:s?.bill_reference||"",bill_amount:s?.bill_amount?.toString()||""}),R=`mt-1 block w-full rounded-md border-gray-300 shadow-sm ${y}`,o=`mt-1 block w-full rounded-md border-gray-300 shadow-sm ${y}`,I=t=>{t.preventDefault();const n=a.data.receipts.filter(i=>i.quantity>0);if(n.length===0){a.setError("receipts","Enter at least one quantity to receive.");return}a.setData("receipts",n),a.post(route("projects.modules.purchase.receive",[l.id,s.id]),{preserveScroll:!0,onSuccess:()=>c(!1)})},B=t=>{t.preventDefault(),r.patch(route("projects.modules.purchase.bill",[l.id,s.id]),{preserveScroll:!0,onSuccess:()=>d(!1)})},L=(t,n)=>{const i=[...a.data.receipts];i[t]={...i[t],quantity:parseInt(n,10)||0},a.setData("receipts",i)};if(!s)return null;const f=s.items?.some(t=>t.quantity_remaining>0);return e.jsxs(M,{header:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(u,{href:route("projects.modules.purchase.index",l.id),className:"rounded-lg p-2 text-gray-500 hover:bg-gray-100 hover:text-gray-700",children:e.jsx("svg",{className:"h-5 w-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),e.jsx("div",{className:"flex h-10 w-10 shrink-0 items-center justify-center rounded-lg bg-indigo-100 text-indigo-600",children:e.jsx(F,{className:"h-5 w-5"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold leading-tight text-gray-800",children:s.order_number}),e.jsx("p",{className:"mt-0.5 text-sm text-gray-500",children:e.jsx("span",{className:`inline-flex rounded-full px-2.5 py-0.5 text-xs font-medium capitalize ${O[s.status]||"bg-gray-100"}`,children:s.status})})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[s.can_update&&s.status==="draft"&&e.jsx(u,{href:route("projects.modules.purchase.edit",[l.id,s.id]),children:e.jsxs(m,{children:[e.jsx($,{className:"h-4 w-4"}),"Edit"]})}),s.can_receive&&f&&s.status!=="cancelled"&&e.jsxs(x,{onClick:()=>c(!0),children:[e.jsx(T,{className:"h-4 w-4"}),"Receive"]}),s.can_update&&e.jsxs(m,{onClick:()=>{d(!0),r.setData({bill_reference:s.bill_reference||"",bill_amount:s.bill_amount?.toString()||""})},children:[e.jsx(w,{className:"h-4 w-4"}),"Supplier Bill"]}),s.can_update&&s.status==="draft"&&e.jsx(x,{onClick:()=>v.post(route("projects.modules.purchase.send",[l.id,s.id]),{}),children:"Send"}),s.can_update&&(s.status==="draft"||s.status==="sent")&&!f&&e.jsx("button",{type:"button",onClick:()=>v.post(route("projects.modules.purchase.cancel",[l.id,s.id]),{}),className:"inline-flex items-center gap-2 rounded-md border border-red-200 px-4 py-2 text-sm font-medium text-red-700 hover:bg-red-50",children:"Cancel"})]})]}),children:[e.jsx(D,{title:`${l?.name} - ${s.order_number}`}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"rounded-xl border border-gray-200 bg-white p-6 shadow-sm",children:[e.jsx("h3",{className:"font-medium text-gray-900 mb-4",children:"Supplier"}),s.supplier?e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx(u,{href:route("projects.modules.suppliers.show",[l.id,s.supplier.id]),className:"font-medium hover:underline",style:{color:k},children:s.supplier.name}),(s.supplier.phone||s.supplier.email)&&e.jsxs("div",{className:"text-sm text-gray-500 mt-1",children:[s.supplier.phone&&e.jsx("span",{children:s.supplier.phone}),s.supplier.phone&&s.supplier.email&&" · ",s.supplier.email&&e.jsx("span",{children:s.supplier.email})]})]})}):e.jsx("p",{className:"text-gray-500",children:"No supplier assigned"}),s.ordered_at&&e.jsxs("p",{className:"mt-2 text-sm text-gray-600",children:["Ordered: ",s.ordered_at]}),s.notes&&e.jsx("p",{className:"mt-2 text-sm text-gray-600 whitespace-pre-wrap",children:s.notes})]}),(s.bill_reference||s.bill_amount)&&e.jsxs("div",{className:"rounded-xl border border-gray-200 bg-white p-6 shadow-sm",children:[e.jsxs("h3",{className:"font-medium text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx(w,{className:"h-5 w-5 text-gray-500"}),"Supplier Bill"]}),e.jsxs("dl",{className:"grid gap-2 sm:grid-cols-2",children:[s.bill_reference&&e.jsxs(e.Fragment,{children:[e.jsx("dt",{className:"text-sm text-gray-500",children:"Reference"}),e.jsx("dd",{className:"font-medium",children:s.bill_reference})]}),s.bill_amount!=null&&e.jsxs(e.Fragment,{children:[e.jsx("dt",{className:"text-sm text-gray-500",children:"Amount"}),e.jsxs("dd",{className:"font-medium",children:[e.jsx(S,{className:"inline h-4 w-4 text-gray-400"})," ",Number(s.bill_amount).toLocaleString()]})]})]})]}),e.jsxs("div",{className:"rounded-xl border border-gray-200 bg-white shadow-sm overflow-hidden",children:[e.jsx("div",{className:"px-6 py-4 bg-gray-50 border-b border-gray-200",children:e.jsx("h3",{className:"font-medium text-gray-900",children:"Items"})}),e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-gray-500",children:"Product"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium uppercase tracking-wider text-gray-500",children:"Ordered"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium uppercase tracking-wider text-gray-500",children:"Received"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium uppercase tracking-wider text-gray-500",children:"Remaining"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium uppercase tracking-wider text-gray-500",children:"Unit Cost"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium uppercase tracking-wider text-gray-500",children:"Total"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200 bg-white",children:s.items?.map(t=>e.jsxs("tr",{children:[e.jsxs("td",{className:"px-6 py-4",children:[e.jsx("span",{className:"font-medium text-gray-900",children:t.product.name}),e.jsxs("span",{className:"text-gray-500 text-sm ml-1",children:["(",t.product.unit,")"]})]}),e.jsx("td",{className:"px-6 py-4 text-right",children:t.quantity_ordered}),e.jsx("td",{className:"px-6 py-4 text-right",children:t.quantity_received}),e.jsx("td",{className:"px-6 py-4 text-right",children:t.quantity_remaining}),e.jsx("td",{className:"px-6 py-4 text-right",children:Number(t.unit_cost).toLocaleString()}),e.jsx("td",{className:"px-6 py-4 text-right font-medium",children:Number(t.line_total).toLocaleString()})]},t.id))})]}),e.jsxs("div",{className:"px-6 py-4 bg-gray-50 border-t border-gray-200 flex justify-end gap-6",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Subtotal"}),e.jsx("span",{className:"font-medium",children:Number(s.subtotal).toLocaleString()})]}),e.jsxs("div",{className:"px-6 py-2 bg-gray-50 flex justify-end gap-6",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Tax"}),e.jsx("span",{className:"font-medium",children:Number(s.tax).toLocaleString()})]}),e.jsxs("div",{className:"px-6 py-4 bg-gray-50 border-t border-gray-200 flex justify-end gap-6",children:[e.jsx("span",{className:"font-medium text-gray-900",children:"Total"}),e.jsxs("span",{className:"font-bold text-lg",children:[e.jsx(S,{className:"inline h-4 w-4 text-gray-400"})," ",Number(s.total).toLocaleString()]})]})]})]}),C&&e.jsx(_,{show:!0,onClose:()=>c(!1),maxWidth:"lg",children:e.jsxs("form",{onSubmit:I,className:"p-6",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Receive Items"}),e.jsx("p",{className:"mt-1 text-sm text-gray-600",children:"Enter quantities received for each item."}),j?.length>0&&e.jsxs("div",{className:"mt-4",children:[e.jsx(h,{value:"Location (optional)"}),e.jsxs("select",{value:a.data.location_id,onChange:t=>a.setData("location_id",t.target.value),className:R,children:[e.jsx("option",{value:"",children:"—"}),j?.map(t=>e.jsxs("option",{value:t.id,children:[t.name," ",t.code?`(${t.code})`:""]},t.id))]})]}),e.jsx("div",{className:"mt-4 space-y-3",children:a.data.receipts?.map((t,n)=>{const i=s.items?.find(p=>p.id===t.item_id);return!i||i.quantity_remaining<=0?null:e.jsxs("div",{className:"flex items-center gap-3 rounded-lg border border-gray-100 bg-gray-50/50 p-3",children:[e.jsx("span",{className:"flex-1 font-medium",children:i.product.name}),e.jsxs("span",{className:"text-sm text-gray-500",children:["Max: ",i.quantity_remaining]}),e.jsx("div",{className:"w-24",children:e.jsx(g,{type:"number",min:"0",max:i.quantity_remaining,value:t.quantity,onChange:p=>L(n,p.target.value),className:o})})]},t.item_id)})}),e.jsx(E,{message:a.errors.receipts}),e.jsxs("div",{className:"mt-6 flex justify-end gap-2",children:[e.jsx(m,{type:"button",onClick:()=>c(!1),children:"Cancel"}),e.jsx(x,{type:"submit",disabled:a.processing,children:"Record Receipt"})]})]})}),q&&e.jsx(_,{show:!0,onClose:()=>d(!1),maxWidth:"sm",children:e.jsxs("form",{onSubmit:B,className:"p-6",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Supplier Bill"}),e.jsx("p",{className:"mt-1 text-sm text-gray-600",children:"Optional reference to link this PO to a supplier invoice."}),e.jsxs("div",{className:"mt-4 space-y-4",children:[e.jsxs("div",{children:[e.jsx(h,{value:"Bill Reference"}),e.jsx(g,{value:r.data.bill_reference,onChange:t=>r.setData("bill_reference",t.target.value),className:o,placeholder:"e.g. INV-2024-001"})]}),e.jsxs("div",{children:[e.jsx(h,{value:"Bill Amount"}),e.jsx(g,{type:"number",step:"0.01",min:"0",value:r.data.bill_amount,onChange:t=>r.setData("bill_amount",t.target.value),className:o})]})]}),e.jsxs("div",{className:"mt-6 flex justify-end gap-2",children:[e.jsx(m,{type:"button",onClick:()=>d(!1),children:"Cancel"}),e.jsx(x,{type:"submit",disabled:r.processing,children:"Save"})]})]})})]})}export{Y as default};
