import{b as C,a as y,u as D,j as e,H as M,L as m}from"./app-D3ELkJMF.js";import{P as I}from"./ProjectLayout-Cy5HwnAr.js";import{M as P,S as E}from"./SecondaryButton-Dw4LUZJv.js";import{P as W}from"./PrimaryButton-CeLk3nx9.js";import{I as j}from"./InputLabel-DY8OfclG.js";import"./TextInput-Bo3CHIip.js";import{e as B,h as H,k as T}from"./Icons-dNo5RJe6.js";import"./AuthErrorHandler-DUS6mXAG.js";import"./Dropdown-RBSSVlCq.js";import"./transition-C9M96Vjn.js";const V={present:"bg-emerald-100 text-emerald-800",absent:"bg-red-100 text-red-800",half_day:"bg-amber-100 text-amber-800",leave:"bg-blue-100 text-blue-800",late:"bg-orange-100 text-orange-800",excused:"bg-gray-100 text-gray-800"},v=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],F=(o,i)=>{if(!i?.length)return!1;const x=new Date(o);return i.some(u=>{const n=new Date(u.start_date),l=new Date(u.end_date);return x>=n&&x<=l})};function ee({project:o,workers:i,attendances_by_worker:x,vacations_by_worker:u={},month:n,year:l,days_in_month:N,can:w}){const k=C().props.currentProject?.primary_color||"#3B82F6",f="focus:border-[var(--project-primary)] focus:ring-[var(--project-primary)]",[S,h]=y.useState(!1),[J,b]=y.useState(null),[O,g]=y.useState([]),s=D({worker_id:"",dates:[],status:"present",notes:""}),A=(t,a)=>{const r=Array.isArray(a)?a:[a];b(t),g(r),s.setData({worker_id:t,dates:r,status:"present",notes:""}),h(!0)},_=t=>{const a=s.data.dates||[],r=a.includes(t)?a.filter(d=>d!==t):[...a,t].sort();s.setData("dates",r),g(r)},$=t=>{t.preventDefault();const a=s.data.worker_id;(s.data.dates||[]).length!==0&&(s.transform(d=>({dates:d.dates,status:d.status,notes:d.notes})),s.post(route("projects.modules.hr.workers.attendances.storeBulk",[o.id,a]),{preserveScroll:!0,onSuccess:()=>{h(!1),b(null),g([])}}))},p=Array.from({length:N},(t,a)=>a+1);return e.jsxs(I,{header:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(m,{href:route("projects.modules.hr.workers.index",o.id),className:"rounded-lg p-2 text-gray-500 hover:bg-gray-100 hover:text-gray-700",children:e.jsx(B,{className:"h-5 w-5"})}),e.jsx("div",{className:"flex h-10 w-10 shrink-0 items-center justify-center rounded-lg bg-indigo-100 text-indigo-600",children:e.jsx(H,{className:"h-5 w-5"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold leading-tight text-gray-800",children:"Attendance Overview"}),e.jsxs("p",{className:"mt-0.5 text-sm text-gray-500",children:[v[n-1]," ",l," · ",i.length," workers"]})]})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs(m,{href:route("projects.modules.hr.workers.index",o.id),className:"inline-flex items-center gap-2 rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50",children:[e.jsx(T,{className:"h-4 w-4"}),"Workers"]})})]}),children:[e.jsx(M,{title:`${o?.name} - Attendance`}),e.jsx("div",{className:"mb-4 flex flex-wrap items-center gap-3 rounded-lg border border-gray-200 bg-white p-4",children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(m,{href:`${route("projects.modules.hr.attendance.index",o.id)}?month=${n===1?12:n-1}&year=${n===1?l-1:l}`,className:"rounded p-1.5 text-gray-600 hover:bg-gray-100",children:e.jsx("svg",{className:"h-5 w-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),e.jsxs("span",{className:"min-w-[120px] text-center font-medium text-gray-900",children:[v[n-1]," ",l]}),e.jsx(m,{href:`${route("projects.modules.hr.attendance.index",o.id)}?month=${n===12?1:n+1}&year=${n===12?l+1:l}`,className:"rounded p-1.5 text-gray-600 hover:bg-gray-100",children:e.jsx("svg",{className:"h-5 w-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})})]})}),e.jsx("div",{className:"overflow-x-auto rounded-xl border border-gray-200 bg-white shadow-sm",children:i.length===0?e.jsx("div",{className:"px-6 py-12 text-center text-sm text-gray-500",children:"No workers in this project. Add workers to track attendance."}):e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"sticky left-0 z-10 bg-gray-50 px-4 py-3 text-left text-xs font-medium uppercase tracking-wider text-gray-500",children:"Worker"}),p.map(t=>e.jsx("th",{className:"px-2 py-3 text-center text-xs font-medium text-gray-500 w-12",children:t},t))]})}),e.jsx("tbody",{className:"divide-y divide-gray-200 bg-white",children:i.map(t=>e.jsxs("tr",{className:"hover:bg-gray-50/50",children:[e.jsx("td",{className:"sticky left-0 z-10 bg-white px-4 py-2 text-sm font-medium text-gray-900 whitespace-nowrap border-r border-gray-100",children:e.jsx(m,{href:route("projects.modules.hr.workers.show",[o.id,t.id]),className:"hover:underline",style:{color:k},children:t.full_name})}),p.map(a=>{const r=`${l}-${String(n).padStart(2,"0")}-${String(a).padStart(2,"0")}`,d=x[t.id]?.[r],L=F(r,u[t.id]||[]),c=d||(L?{status:"leave",status_label:"Vacation"}:null);return e.jsx("td",{className:"px-1 py-1 text-center w-12",children:c?e.jsx("span",{className:`inline-block rounded px-1.5 py-0.5 text-[10px] font-medium ${V[c.status]||"bg-gray-100 text-gray-800"}`,title:c.status_label,children:c.status==="present"?"✓":c.status==="absent"?"✗":c.status==="half_day"?"½":c.status==="leave"?"V":c.status?.charAt(0)||"—"}):w?.create?e.jsx("button",{type:"button",onClick:()=>A(t.id,r),className:"w-full min-h-[24px] rounded text-gray-400 hover:bg-gray-100 hover:text-gray-600 text-[10px]",title:"Add attendance (click to select more days)",children:"+"}):e.jsx("span",{className:"text-gray-300",children:"—"})},a)})]},t.id))})]})}),e.jsx("p",{className:"mt-4 text-sm text-gray-500",children:"Legend: ✓ Present · ✗ Absent · ½ Half day · V Vacation · L Leave · T Late · E Excused. Approved vacations are shown automatically."}),S&&e.jsx(P,{show:!0,onClose:()=>h(!1),maxWidth:"md",children:e.jsxs("form",{onSubmit:$,className:"p-6",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Add Attendance"}),e.jsxs("p",{className:"mt-1 text-sm text-gray-500",children:[i.find(t=>t.id===parseInt(s.data.worker_id,10))?.full_name," · Select one or more days"]}),e.jsxs("div",{className:"mt-4 space-y-4",children:[e.jsxs("div",{children:[e.jsx(j,{value:"Select days"}),e.jsx("div",{className:"mt-2 grid grid-cols-7 gap-1",children:p.map(t=>{const a=`${l}-${String(n).padStart(2,"0")}-${String(t).padStart(2,"0")}`,r=(s.data.dates||[]).includes(a),d=x[s.data.worker_id]?.[a];return e.jsxs("label",{className:`flex cursor-pointer flex-col items-center rounded border p-2 text-center text-xs transition ${r?"border-indigo-500 bg-indigo-50":"border-gray-200 hover:border-gray-300"} ${d?"opacity-60":""}`,children:[e.jsx("input",{type:"checkbox",checked:r,onChange:()=>_(a),className:"sr-only"}),e.jsx("span",{className:"font-medium",children:t}),d&&e.jsx("span",{className:"text-[10px] text-gray-500",children:d.status_label})]},t)})}),e.jsxs("p",{className:"mt-2 text-xs text-gray-500",children:[(s.data.dates||[]).length," day(s) selected. Click days to add/remove."]})]}),e.jsxs("div",{children:[e.jsx(j,{value:"Status"}),e.jsxs("select",{value:s.data.status,onChange:t=>s.setData("status",t.target.value),className:`mt-1 block w-full rounded-md border-gray-300 shadow-sm ${f}`,children:[e.jsx("option",{value:"present",children:"Present"}),e.jsx("option",{value:"absent",children:"Absent"}),e.jsx("option",{value:"half_day",children:"Half day"}),e.jsx("option",{value:"leave",children:"Leave"}),e.jsx("option",{value:"late",children:"Late"}),e.jsx("option",{value:"excused",children:"Excused"})]})]}),e.jsxs("div",{children:[e.jsx(j,{value:"Notes"}),e.jsx("textarea",{value:s.data.notes,onChange:t=>s.setData("notes",t.target.value),rows:2,className:`mt-1 block w-full rounded-md border-gray-300 shadow-sm ${f}`})]})]}),e.jsxs("div",{className:"mt-6 flex justify-end gap-2",children:[e.jsx(E,{type:"button",onClick:()=>h(!1),children:"Cancel"}),e.jsxs(W,{type:"submit",disabled:s.processing||(s.data.dates||[]).length===0,children:["Save (",(s.data.dates||[]).length," days)"]})]})]})})]})}export{ee as default};
