import{b as z,a as u,u as y,j as e,H as K,L as M,r as P}from"./app-BOe1Q-5t.js";import{P as Q}from"./ProjectLayout-BYMxZp2a.js";import{M as g,S as j}from"./SecondaryButton-BbkNJ64E.js";import{P as o}from"./PrimaryButton-CbX6iTTm.js";import{I as s}from"./InputLabel-CDt49QPP.js";import{T as d}from"./TextInput-Dc20_Y0Q.js";import{g as X,i as Z,h as I,j as ee,f as _,e as te,k as ae,b as se}from"./Icons-BTusnia4.js";import"./AuthErrorHandler-f-fRK3X0.js";import"./Dropdown-DtTclzYU.js";import"./transition-CSX3AbWh.js";const re=[{key:"contract",label:"Contract",icon:X},{key:"salary",label:"Salary",icon:Z},{key:"attendance",label:"Attendance",icon:I},{key:"vacations",label:"Vacations",icon:I},{key:"cnss",label:"CNSS",icon:ee}],R=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function pe({project:i,worker:a,can:h}){const q=z().props.currentProject?.primary_color||"#3B82F6",k="focus:border-[var(--project-primary)] focus:ring-[var(--project-primary)]",[m,F]=u.useState("contract"),[T,v]=u.useState(!1),[$,f]=u.useState(!1),[L,b]=u.useState(!1),[V,N]=u.useState(!1),[w,S]=u.useState(null),A=new Date,x=y({month:String(A.getMonth()+1),year:String(A.getFullYear())}),l=y({payment_method:"transfer",amount:"",reference:"",payment_date:new Date().toISOString().slice(0,10),notes:""}),r=y({type:"cdi",status:"draft",start_date:new Date().toISOString().slice(0,10),end_date:"",salary_amount:"",salary_currency:"MAD",notes:""}),c=y({start_date:"",end_date:"",notes:""}),n=y({registration_number:"",registration_date:"",status:"active",notes:""}),E=t=>{t.preventDefault(),x.post(route("projects.modules.hr.workers.salaries.generate",[i.id,a.id]),{preserveScroll:!0,onSuccess:()=>{v(!1),x.reset()}})},O=t=>{S(t),l.setData({payment_method:"transfer",amount:t.net_amount.toString(),reference:"",payment_date:new Date().toISOString().slice(0,10),notes:""})},W=t=>{t.preventDefault(),w&&l.post(route("projects.modules.hr.workers.salaries.pay",[i.id,w.id]),{preserveScroll:!0,onSuccess:()=>{S(null)}})},G=t=>{t.preventDefault(),r.post(route("projects.modules.hr.workers.contracts.store",[i.id,a.id]),{preserveScroll:!0,onSuccess:()=>{f(!1),r.reset()}})},B=t=>{t.preventDefault(),c.post(route("projects.modules.hr.workers.vacations.store",[i.id,a.id]),{preserveScroll:!0,onSuccess:()=>{b(!1),c.reset()}})},H=t=>{t.preventDefault(),n.post(route("projects.modules.hr.workers.cnss.store",[i.id,a.id]),{preserveScroll:!0,onSuccess:()=>{N(!1),n.reset()}})},J=t=>{P.post(route("projects.modules.hr.vacations.approve",[i.id,t.id]),{},{preserveScroll:!0})},U=t=>{P.post(route("projects.modules.hr.vacations.reject",[i.id,t.id]),{rejection_reason:""},{preserveScroll:!0})},p=`mt-1 block w-full rounded-md border-gray-300 shadow-sm ${k}`,D=`mt-1 block w-full rounded-md border-gray-300 shadow-sm ${k}`;return a?e.jsxs(Q,{header:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(M,{href:route("projects.modules.hr.workers.index",i.id),className:"rounded-lg p-2 text-gray-500 hover:bg-gray-100 hover:text-gray-700",children:e.jsx(te,{className:"h-5 w-5"})}),e.jsx("div",{className:"flex h-10 w-10 shrink-0 items-center justify-center rounded-lg bg-indigo-100 text-indigo-600",children:e.jsx(ae,{className:"h-5 w-5"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold leading-tight text-gray-800",children:a.full_name}),e.jsxs("p",{className:"mt-0.5 text-sm text-gray-500",children:[a.employee_number&&`#${a.employee_number} · `,a.cnss_number&&`CNSS ${a.cnss_number} · `,a.email||a.phone||"No contact"]})]})]}),e.jsx("div",{className:"flex items-center gap-2",children:h?.update&&e.jsxs(M,{href:route("projects.modules.hr.workers.index",i.id),className:"inline-flex items-center gap-2 rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50",children:[e.jsx(se,{className:"h-4 w-4"}),"Edit"]})})]}),children:[e.jsx(K,{title:`${i?.name} - ${a.full_name}`}),e.jsx("div",{className:"mb-6 border-b border-gray-200",children:e.jsx("nav",{className:"-mb-px flex gap-6",children:re.map(({key:t,label:C,icon:Y})=>e.jsxs("button",{type:"button",onClick:()=>F(t),className:`flex items-center gap-2 border-b-2 py-4 text-sm font-medium ${m===t?"border-[var(--project-primary)] text-[var(--project-primary)]":"border-transparent text-gray-500 hover:border-gray-300 hover:text-gray-700"}`,children:[e.jsx(Y,{className:"h-5 w-5"}),C]},t))})}),m==="contract"&&e.jsxs("div",{className:"rounded-xl border border-gray-200 bg-white shadow-sm overflow-hidden",children:[e.jsxs("div",{className:"px-6 py-4 bg-gray-50 border-b border-gray-200 flex items-center justify-between",children:[e.jsx("h3",{className:"font-medium text-gray-900",children:"Contracts"}),h?.create_contract&&e.jsxs(o,{onClick:()=>f(!0),children:[e.jsx(_,{className:"h-4 w-4"}),"Add Contract"]})]}),a.contracts?.length>0?e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-gray-500",children:"Type"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-gray-500",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-gray-500",children:"Dates"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium uppercase tracking-wider text-gray-500",children:"Salary"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200 bg-white",children:a.contracts.map(t=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-6 py-4 text-sm font-medium text-gray-900",children:t.type_label}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:`inline-flex rounded-full px-2.5 py-0.5 text-xs font-medium ${t.status==="active"?"bg-emerald-100 text-emerald-800":t.status==="draft"?"bg-gray-100 text-gray-800":"bg-red-100 text-red-800"}`,children:t.status_label})}),e.jsxs("td",{className:"px-6 py-4 text-sm text-gray-600",children:[t.start_date," – ",t.end_date||"—"]}),e.jsxs("td",{className:"px-6 py-4 text-sm text-right font-medium",children:[Number(t.salary_amount).toLocaleString()," ",t.salary_currency]})]},t.id))})]}):e.jsx("div",{className:"px-6 py-12 text-center text-sm text-gray-500",children:"No contracts yet. Add a contract to enable salary generation."})]}),m==="salary"&&e.jsxs("div",{className:"rounded-xl border border-gray-200 bg-white shadow-sm overflow-hidden",children:[e.jsxs("div",{className:"px-6 py-4 bg-gray-50 border-b border-gray-200 flex items-center justify-between",children:[e.jsx("h3",{className:"font-medium text-gray-900",children:"Salaries"}),h?.create_salary&&e.jsxs(o,{onClick:()=>v(!0),children:[e.jsx(_,{className:"h-4 w-4"}),"Generate Salary"]})]}),a.salaries?.length>0?e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-gray-500",children:"Period"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium uppercase tracking-wider text-gray-500",children:"Gross"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium uppercase tracking-wider text-gray-500",children:"Net"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-gray-500",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium uppercase tracking-wider text-gray-500",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200 bg-white",children:a.salaries.map(t=>e.jsxs("tr",{children:[e.jsxs("td",{className:"px-6 py-4 text-sm font-medium text-gray-900",children:[R[t.month-1]," ",t.year]}),e.jsx("td",{className:"px-6 py-4 text-sm text-right",children:Number(t.gross_amount).toLocaleString()}),e.jsx("td",{className:"px-6 py-4 text-sm text-right font-medium",children:Number(t.net_amount).toLocaleString()}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:`inline-flex rounded-full px-2.5 py-0.5 text-xs font-medium ${t.status==="paid"?"bg-emerald-100 text-emerald-800":t.status==="generated"?"bg-amber-100 text-amber-800":"bg-gray-100 text-gray-800"}`,children:t.status_label})}),e.jsx("td",{className:"px-6 py-4 text-right",children:t.status==="generated"&&e.jsx("button",{type:"button",onClick:()=>O(t),className:"text-sm font-medium",style:{color:q},children:"Record Payment"})})]},t.id))})]}):e.jsx("div",{className:"px-6 py-12 text-center text-sm text-gray-500",children:"No salaries generated yet. Ensure the worker has an active contract, then generate a salary."})]}),m==="attendance"&&e.jsxs("div",{className:"rounded-xl border border-gray-200 bg-white p-6 shadow-sm",children:[e.jsx("h3",{className:"font-medium text-gray-900",children:"Attendance"}),e.jsx("p",{className:"mt-2 text-sm text-gray-500",children:"Attendance tracking (working days) will be available. Use the calendar view to record daily attendance."}),e.jsx("p",{className:"mt-4 text-sm text-gray-400 italic",children:"Full calendar view coming soon."})]}),m==="vacations"&&e.jsxs("div",{className:"rounded-xl border border-gray-200 bg-white shadow-sm overflow-hidden",children:[e.jsxs("div",{className:"px-6 py-4 bg-gray-50 border-b border-gray-200 flex items-center justify-between",children:[e.jsx("h3",{className:"font-medium text-gray-900",children:"Vacations (Congés)"}),h?.create_vacation&&e.jsxs(o,{onClick:()=>b(!0),children:[e.jsx(_,{className:"h-4 w-4"}),"Request Vacation"]})]}),a.vacations?.length>0?e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-gray-500",children:"Period"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-gray-500",children:"Days"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-gray-500",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium uppercase tracking-wider text-gray-500",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200 bg-white",children:a.vacations.map(t=>e.jsxs("tr",{children:[e.jsxs("td",{className:"px-6 py-4 text-sm text-gray-900",children:[t.start_date," – ",t.end_date]}),e.jsxs("td",{className:"px-6 py-4 text-sm text-gray-600",children:[t.days_count," days"]}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:`inline-flex rounded-full px-2.5 py-0.5 text-xs font-medium ${t.status==="approved"?"bg-emerald-100 text-emerald-800":t.status==="rejected"?"bg-red-100 text-red-800":"bg-amber-100 text-amber-800"}`,children:t.status_label})}),e.jsx("td",{className:"px-6 py-4 text-right",children:t.status==="pending"&&t.can_approve&&e.jsxs("span",{className:"flex gap-2 justify-end",children:[e.jsx("button",{type:"button",onClick:()=>J(t),className:"text-sm font-medium text-emerald-600 hover:text-emerald-500",children:"Approve"}),e.jsx("button",{type:"button",onClick:()=>U(t),className:"text-sm font-medium text-red-600 hover:text-red-500",children:"Reject"})]})})]},t.id))})]}):e.jsx("div",{className:"px-6 py-12 text-center text-sm text-gray-500",children:"No vacation requests yet."})]}),m==="cnss"&&e.jsxs("div",{className:"rounded-xl border border-gray-200 bg-white shadow-sm overflow-hidden",children:[e.jsxs("div",{className:"px-6 py-4 bg-gray-50 border-b border-gray-200 flex items-center justify-between",children:[e.jsx("h3",{className:"font-medium text-gray-900",children:"CNSS Records"}),h?.create_cnss&&e.jsxs(o,{onClick:()=>N(!0),children:[e.jsx(_,{className:"h-4 w-4"}),"Add CNSS Record"]})]}),a.cnss_records?.length>0?e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-gray-500",children:"Registration #"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-gray-500",children:"Date"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-gray-500",children:"Status"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200 bg-white",children:a.cnss_records.map(t=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-6 py-4 text-sm font-medium text-gray-900",children:t.registration_number}),e.jsx("td",{className:"px-6 py-4 text-sm text-gray-600",children:t.registration_date||"—"}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:`inline-flex rounded-full px-2.5 py-0.5 text-xs font-medium capitalize ${t.status==="active"?"bg-emerald-100 text-emerald-800":"bg-gray-100 text-gray-800"}`,children:t.status})})]},t.id))})]}):e.jsx("div",{className:"px-6 py-12 text-center text-sm text-gray-500",children:"No CNSS records yet."})]}),T&&e.jsx(g,{show:!0,onClose:()=>v(!1),maxWidth:"sm",children:e.jsxs("form",{onSubmit:E,className:"p-6",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Generate Salary"}),e.jsxs("div",{className:"mt-4 space-y-4",children:[e.jsxs("div",{children:[e.jsx(s,{value:"Month"}),e.jsx("select",{value:x.data.month,onChange:t=>x.setData("month",t.target.value),className:p+" w-full",children:R.map((t,C)=>e.jsx("option",{value:C+1,children:t},C))})]}),e.jsxs("div",{children:[e.jsx(s,{value:"Year"}),e.jsx(d,{type:"number",min:"2020",max:"2100",value:x.data.year,onChange:t=>x.setData("year",t.target.value),className:"block w-full",required:!0})]}),e.jsx("p",{className:"text-sm text-gray-500",children:"Salary will be generated based on the active contract."})]}),e.jsxs("div",{className:"mt-6 flex justify-end gap-2",children:[e.jsx(j,{type:"button",onClick:()=>v(!1),children:"Cancel"}),e.jsx(o,{type:"submit",disabled:x.processing,children:"Generate"})]})]})}),w&&e.jsx(g,{show:!0,onClose:()=>S(null),maxWidth:"md",children:e.jsxs("form",{onSubmit:W,className:"p-6",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Record Salary Payment"}),e.jsxs("p",{className:"mt-1 text-sm text-gray-500",children:["Net amount: ",Number(w.net_amount).toLocaleString()]}),e.jsxs("div",{className:"mt-4 space-y-4",children:[e.jsxs("div",{children:[e.jsx(s,{value:"Amount"}),e.jsx(d,{type:"number",step:"0.01",min:"0.01",value:l.data.amount,onChange:t=>l.setData("amount",t.target.value),className:"block w-full",required:!0})]}),e.jsxs("div",{children:[e.jsx(s,{value:"Payment Method"}),e.jsxs("select",{value:l.data.payment_method,onChange:t=>l.setData("payment_method",t.target.value),className:p+" w-full",children:[e.jsx("option",{value:"cash",children:"Cash"}),e.jsx("option",{value:"card",children:"Card"}),e.jsx("option",{value:"transfer",children:"Transfer"}),e.jsx("option",{value:"check",children:"Check"}),e.jsx("option",{value:"other",children:"Other"})]})]}),e.jsxs("div",{children:[e.jsx(s,{value:"Payment Date"}),e.jsx(d,{type:"date",value:l.data.payment_date,onChange:t=>l.setData("payment_date",t.target.value),className:"block w-full",required:!0})]}),e.jsxs("div",{children:[e.jsx(s,{value:"Reference"}),e.jsx(d,{value:l.data.reference,onChange:t=>l.setData("reference",t.target.value),className:"block w-full"})]})]}),e.jsxs("div",{className:"mt-6 flex justify-end gap-2",children:[e.jsx(j,{type:"button",onClick:()=>S(null),children:"Cancel"}),e.jsx(o,{type:"submit",disabled:l.processing,children:"Record Payment"})]})]})}),$&&e.jsx(g,{show:!0,onClose:()=>f(!1),maxWidth:"md",children:e.jsxs("form",{onSubmit:G,className:"p-6",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Add Contract"}),e.jsxs("div",{className:"mt-4 space-y-4",children:[e.jsxs("div",{children:[e.jsx(s,{value:"Type"}),e.jsxs("select",{value:r.data.type,onChange:t=>r.setData("type",t.target.value),className:p+" w-full",children:[e.jsx("option",{value:"cdi",children:"CDI (Indefinite)"}),e.jsx("option",{value:"cdd",children:"CDD (Fixed-term)"}),e.jsx("option",{value:"freelance",children:"Freelance"})]})]}),e.jsxs("div",{children:[e.jsx(s,{value:"Status"}),e.jsxs("select",{value:r.data.status,onChange:t=>r.setData("status",t.target.value),className:p+" w-full",children:[e.jsx("option",{value:"draft",children:"Draft"}),e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"terminated",children:"Terminated"}),e.jsx("option",{value:"expired",children:"Expired"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(s,{value:"Start Date"}),e.jsx(d,{type:"date",value:r.data.start_date,onChange:t=>r.setData("start_date",t.target.value),className:"block w-full",required:!0})]}),e.jsxs("div",{children:[e.jsx(s,{value:"End Date (CDD)"}),e.jsx(d,{type:"date",value:r.data.end_date,onChange:t=>r.setData("end_date",t.target.value),className:"block w-full"})]})]}),e.jsxs("div",{children:[e.jsx(s,{value:"Salary Amount"}),e.jsx(d,{type:"number",step:"0.01",min:"0",value:r.data.salary_amount,onChange:t=>r.setData("salary_amount",t.target.value),className:"block w-full",required:!0})]}),e.jsxs("div",{children:[e.jsx(s,{value:"Notes"}),e.jsx("textarea",{value:r.data.notes,onChange:t=>r.setData("notes",t.target.value),rows:2,className:D+" w-full"})]})]}),e.jsxs("div",{className:"mt-6 flex justify-end gap-2",children:[e.jsx(j,{type:"button",onClick:()=>f(!1),children:"Cancel"}),e.jsx(o,{type:"submit",disabled:r.processing,children:"Add Contract"})]})]})}),L&&e.jsx(g,{show:!0,onClose:()=>b(!1),maxWidth:"sm",children:e.jsxs("form",{onSubmit:B,className:"p-6",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Request Vacation"}),e.jsxs("div",{className:"mt-4 space-y-4",children:[e.jsxs("div",{children:[e.jsx(s,{value:"Start Date"}),e.jsx(d,{type:"date",value:c.data.start_date,onChange:t=>c.setData("start_date",t.target.value),className:"block w-full",required:!0})]}),e.jsxs("div",{children:[e.jsx(s,{value:"End Date"}),e.jsx(d,{type:"date",value:c.data.end_date,onChange:t=>c.setData("end_date",t.target.value),className:"block w-full",required:!0})]}),e.jsxs("div",{children:[e.jsx(s,{value:"Notes"}),e.jsx("textarea",{value:c.data.notes,onChange:t=>c.setData("notes",t.target.value),rows:2,className:D+" w-full"})]})]}),e.jsxs("div",{className:"mt-6 flex justify-end gap-2",children:[e.jsx(j,{type:"button",onClick:()=>b(!1),children:"Cancel"}),e.jsx(o,{type:"submit",disabled:c.processing,children:"Submit Request"})]})]})}),V&&e.jsx(g,{show:!0,onClose:()=>N(!1),maxWidth:"sm",children:e.jsxs("form",{onSubmit:H,className:"p-6",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Add CNSS Record"}),e.jsxs("div",{className:"mt-4 space-y-4",children:[e.jsxs("div",{children:[e.jsx(s,{value:"Registration Number"}),e.jsx(d,{value:n.data.registration_number,onChange:t=>n.setData("registration_number",t.target.value),className:"block w-full",required:!0})]}),e.jsxs("div",{children:[e.jsx(s,{value:"Registration Date"}),e.jsx(d,{type:"date",value:n.data.registration_date,onChange:t=>n.setData("registration_date",t.target.value),className:"block w-full"})]}),e.jsxs("div",{children:[e.jsx(s,{value:"Status"}),e.jsxs("select",{value:n.data.status,onChange:t=>n.setData("status",t.target.value),className:p+" w-full",children:[e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"inactive",children:"Inactive"}),e.jsx("option",{value:"suspended",children:"Suspended"})]})]}),e.jsxs("div",{children:[e.jsx(s,{value:"Notes"}),e.jsx("textarea",{value:n.data.notes,onChange:t=>n.setData("notes",t.target.value),rows:2,className:D+" w-full"})]})]}),e.jsxs("div",{className:"mt-6 flex justify-end gap-2",children:[e.jsx(j,{type:"button",onClick:()=>N(!1),children:"Cancel"}),e.jsx(o,{type:"submit",disabled:n.processing,children:"Add"})]})]})})]}):null}export{pe as default};
