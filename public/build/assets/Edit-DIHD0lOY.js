import{a as w,u as I,j as e,H as C,b as S,L as v}from"./app-CNtjz-n6.js";import{P as q}from"./ProjectLayout-C2dzVJMm.js";import{P}from"./PrimaryButton-BnKcJi9k.js";import{S as k}from"./SecondaryButton-DYJNMu7q.js";import{I as d}from"./InputLabel-Bagl131a.js";import{T as p}from"./TextInput-BOlirjT3.js";import{I as D}from"./InputError-D7t3_rpe.js";import{f as E,c as L}from"./Icons-CyrJO6rX.js";import"./AuthErrorHandler-2P6lq71E.js";import"./Dropdown-DzIt9eqU.js";import"./transition-uswAIGXr.js";function W({project:n,order:o,suppliers:f,products:h}){const x="focus:border-[var(--project-primary)] focus:ring-[var(--project-primary)]",[i,u]=w.useState(o?.items?.map(t=>({product_id:t.product_id.toString(),quantity_ordered:t.quantity_ordered,unit_cost:t.unit_cost.toString()}))??[{product_id:"",quantity_ordered:1,unit_cost:""}]),r=I({supplier_id:o?.supplier_id?.toString()||"",ordered_at:o?.ordered_at||new Date().toISOString().slice(0,10),notes:o?.notes||"",items:[]}),y=()=>{u([...i,{product_id:"",quantity_ordered:1,unit_cost:""}])},_=t=>{u(i.filter((a,s)=>s!==t))},m=(t,a,s)=>{const c=[...i];if(c[t]={...c[t],[a]:s},a==="product_id"){const g=h?.find(N=>N.id===parseInt(s,10));g&&(c[t].unit_cost=g.cost_price?.toString()??"")}u(c)},j=`mt-1 block w-full rounded-md border-gray-300 shadow-sm ${x}`,l=`mt-1 block w-full rounded-md border-gray-300 shadow-sm ${x}`,b=t=>{t.preventDefault();const a=i.filter(s=>s.product_id&&s.quantity_ordered>0).map(s=>({product_id:parseInt(s.product_id,10),quantity_ordered:parseInt(s.quantity_ordered,10),unit_cost:parseFloat(s.unit_cost)||0}));if(a.length===0){r.setError("items","Add at least one item.");return}r.setData({...r.data,items:a}),r.patch(route("projects.modules.purchase.update",[n.id,o.id]),{preserveScroll:!0})};return o?e.jsxs(q,{header:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(v,{href:route("projects.modules.purchase.show",[n.id,o.id]),className:"rounded-lg p-2 text-gray-500 hover:bg-gray-100 hover:text-gray-700",children:e.jsx("svg",{className:"h-5 w-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xl font-semibold leading-tight text-gray-800",children:["Edit ",o.order_number]}),e.jsx("p",{className:"mt-0.5 text-sm text-gray-500",children:"Update purchase order"})]})]})}),children:[e.jsx(C,{title:`${n?.name} - Edit ${o.order_number}`}),e.jsxs("form",{onSubmit:b,className:"space-y-6",children:[e.jsxs("div",{className:"rounded-xl border border-gray-200 bg-white p-6 shadow-sm",children:[e.jsx("h3",{className:"font-medium text-gray-900 mb-4",children:"Order Details"}),e.jsxs("div",{className:"grid gap-4 sm:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx(d,{value:"Supplier"}),e.jsxs("select",{value:r.data.supplier_id,onChange:t=>r.setData("supplier_id",t.target.value),className:j,children:[e.jsx("option",{value:"",children:"â€”"}),f?.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]})]}),e.jsxs("div",{children:[e.jsx(d,{value:"Order Date"}),e.jsx(p,{type:"date",value:r.data.ordered_at,onChange:t=>r.setData("ordered_at",t.target.value),className:l})]}),e.jsxs("div",{className:"sm:col-span-2",children:[e.jsx(d,{value:"Notes"}),e.jsx("textarea",{value:r.data.notes,onChange:t=>r.setData("notes",t.target.value),className:l,rows:2})]})]})]}),e.jsxs("div",{className:"rounded-xl border border-gray-200 bg-white p-6 shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"font-medium text-gray-900",children:"Items"}),e.jsxs("button",{type:"button",onClick:y,className:"inline-flex items-center gap-2 text-sm font-medium hover:opacity-80",style:{color:S().props.currentProject?.primary_color||"#3B82F6"},children:[e.jsx(E,{className:"h-4 w-4"}),"Add Item"]})]}),e.jsx("div",{className:"space-y-3",children:i.map((t,a)=>e.jsxs("div",{className:"flex flex-wrap items-end gap-3 rounded-lg border border-gray-100 bg-gray-50/50 p-3",children:[e.jsxs("div",{className:"flex-1 min-w-[180px]",children:[e.jsx(d,{value:"Product"}),e.jsxs("select",{value:t.product_id,onChange:s=>m(a,"product_id",s.target.value),className:j,required:!0,children:[e.jsx("option",{value:"",children:"Select product"}),h?.map(s=>e.jsxs("option",{value:s.id,children:[s.name," (",s.unit,")"]},s.id))]})]}),e.jsxs("div",{className:"w-24",children:[e.jsx(d,{value:"Qty"}),e.jsx(p,{type:"number",min:"1",value:t.quantity_ordered,onChange:s=>m(a,"quantity_ordered",s.target.value),className:l})]}),e.jsxs("div",{className:"w-28",children:[e.jsx(d,{value:"Unit Cost"}),e.jsx(p,{type:"number",step:"0.01",min:"0",value:t.unit_cost,onChange:s=>m(a,"unit_cost",s.target.value),className:l})]}),e.jsx("button",{type:"button",onClick:()=>_(a),className:"p-2 text-gray-400 hover:text-red-600",title:"Remove",children:e.jsx(L,{className:"h-4 w-4"})})]},a))}),e.jsx(D,{message:r.errors.items})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(v,{href:route("projects.modules.purchase.show",[n.id,o.id]),children:e.jsx(k,{type:"button",children:"Cancel"})}),e.jsx(P,{type:"submit",disabled:r.processing,children:"Update Purchase Order"})]})]})]}):null}export{W as default};
