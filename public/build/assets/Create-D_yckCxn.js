import{a as _,u as w,j as e,H as I,b as C,L as v}from"./app-CV_ed7_i.js";import{P}from"./ProjectLayout-CCBX1sk_.js";import{P as S}from"./PrimaryButton-fG5qMxE-.js";import{S as k}from"./SecondaryButton-PnKEJt8F.js";import{I as o}from"./InputLabel-Covi2RWO.js";import{T as m}from"./TextInput-BQNjFm02.js";import{I as q}from"./InputError-chaytR5f.js";import{j as D,h as L}from"./Icons-CUEBKkf-.js";import"./AuthErrorHandler-CZjHl6Ix.js";import"./Dropdown-BLtL5ZC7.js";import"./transition-wRWBGdP0.js";function U({project:i,suppliers:g,products:p}){const x="focus:border-[var(--project-primary)] focus:ring-[var(--project-primary)]",[d,c]=_.useState([{product_id:"",quantity_ordered:1,unit_cost:""}]),r=w({supplier_id:"",ordered_at:new Date().toISOString().slice(0,10),notes:"",items:[]}),f=()=>{c([...d,{product_id:"",quantity_ordered:1,unit_cost:""}])},y=t=>{c(d.filter((a,s)=>s!==t))},u=(t,a,s)=>{const l=[...d];if(l[t]={...l[t],[a]:s},a==="product_id"){const j=p?.find(N=>N.id===parseInt(s,10));j&&(l[t].unit_cost=j.cost_price??"")}c(l)},h=`mt-1 block w-full rounded-md border-gray-300 shadow-sm ${x}`,n=`mt-1 block w-full rounded-md border-gray-300 shadow-sm ${x}`,b=t=>{t.preventDefault();const a=d.filter(s=>s.product_id&&s.quantity_ordered>0).map(s=>({product_id:parseInt(s.product_id,10),quantity_ordered:parseInt(s.quantity_ordered,10),unit_cost:parseFloat(s.unit_cost)||0}));if(a.length===0){r.setError("items","Add at least one item.");return}r.setData({...r.data,items:a}),r.post(route("projects.modules.purchase.store",i.id),{preserveScroll:!0})};return e.jsxs(P,{header:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(v,{href:route("projects.modules.purchase.index",i.id),className:"rounded-lg p-2 text-gray-500 hover:bg-gray-100 hover:text-gray-700",children:e.jsx("svg",{className:"h-5 w-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold leading-tight text-gray-800",children:"New Purchase Order"}),e.jsx("p",{className:"mt-0.5 text-sm text-gray-500",children:"Create a purchase order"})]})]})}),children:[e.jsx(I,{title:`${i?.name} - New Purchase Order`}),e.jsxs("form",{onSubmit:b,className:"space-y-6",children:[e.jsxs("div",{className:"rounded-xl border border-gray-200 bg-white p-6 shadow-sm",children:[e.jsx("h3",{className:"font-medium text-gray-900 mb-4",children:"Order Details"}),e.jsxs("div",{className:"grid gap-4 sm:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx(o,{value:"Supplier"}),e.jsxs("select",{value:r.data.supplier_id,onChange:t=>r.setData("supplier_id",t.target.value),className:h,children:[e.jsx("option",{value:"",children:"â€”"}),g?.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]})]}),e.jsxs("div",{children:[e.jsx(o,{value:"Order Date"}),e.jsx(m,{type:"date",value:r.data.ordered_at,onChange:t=>r.setData("ordered_at",t.target.value),className:n})]}),e.jsxs("div",{className:"sm:col-span-2",children:[e.jsx(o,{value:"Notes"}),e.jsx("textarea",{value:r.data.notes,onChange:t=>r.setData("notes",t.target.value),className:n,rows:2})]})]})]}),e.jsxs("div",{className:"rounded-xl border border-gray-200 bg-white p-6 shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"font-medium text-gray-900",children:"Items"}),e.jsxs("button",{type:"button",onClick:f,className:"inline-flex items-center gap-2 text-sm font-medium hover:opacity-80",style:{color:C().props.currentProject?.primary_color||"#3B82F6"},children:[e.jsx(D,{className:"h-4 w-4"}),"Add Item"]})]}),e.jsx("div",{className:"space-y-3",children:d.map((t,a)=>e.jsxs("div",{className:"flex flex-wrap items-end gap-3 rounded-lg border border-gray-100 bg-gray-50/50 p-3",children:[e.jsxs("div",{className:"flex-1 min-w-[180px]",children:[e.jsx(o,{value:"Product"}),e.jsxs("select",{value:t.product_id,onChange:s=>u(a,"product_id",s.target.value),className:h,required:!0,children:[e.jsx("option",{value:"",children:"Select product"}),p?.map(s=>e.jsxs("option",{value:s.id,children:[s.name," (",s.unit,")"]},s.id))]})]}),e.jsxs("div",{className:"w-24",children:[e.jsx(o,{value:"Qty"}),e.jsx(m,{type:"number",min:"1",value:t.quantity_ordered,onChange:s=>u(a,"quantity_ordered",s.target.value),className:n})]}),e.jsxs("div",{className:"w-28",children:[e.jsx(o,{value:"Unit Cost"}),e.jsx(m,{type:"number",step:"0.01",min:"0",value:t.unit_cost,onChange:s=>u(a,"unit_cost",s.target.value),className:n})]}),e.jsx("button",{type:"button",onClick:()=>y(a),className:"p-2 text-gray-400 hover:text-red-600",title:"Remove",children:e.jsx(L,{className:"h-4 w-4"})})]},a))}),e.jsx(q,{message:r.errors.items})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(v,{href:route("projects.modules.purchase.index",i.id),children:e.jsx(k,{type:"button",children:"Cancel"})}),e.jsx(S,{type:"submit",disabled:r.processing,children:"Create Purchase Order"})]})]})]})}export{U as default};
